version: '3.8'

services:
  # Versões mínimas dos componentes para testes de integração
  proposer-test:
    build:
      context: ../../proposer
      dockerfile: Dockerfile
    environment:
      - NODE_ID=1
      - NODE_ROLE=proposer
      - QUORUM_SIZE=2
    volumes:
      - proposer_test_data:/app/data
    ports:
      - "8091:8080"
    networks:
      - paxos_test_network

  acceptor-1-test:
    build:
      context: ../../acceptor
      dockerfile: Dockerfile
    environment:
      - NODE_ID=1
      - NODE_ROLE=acceptor
    volumes:
      - acceptor_1_test_data:/app/data
    networks:
      - paxos_test_network

  acceptor-2-test:
    build:
      context: ../../acceptor
      dockerfile: Dockerfile
    environment:
      - NODE_ID=2
      - NODE_ROLE=acceptor
    volumes:
      - acceptor_2_test_data:/app/data
    networks:
      - paxos_test_network

  acceptor-3-test:
    build:
      context: ../../acceptor
      dockerfile: Dockerfile
    environment:
      - NODE_ID=3
      - NODE_ROLE=acceptor
    volumes:
      - acceptor_3_test_data:/app/data
    networks:
      - paxos_test_network

  learner-test:
    build:
      context: ../../learner
      dockerfile: Dockerfile
    environment:
      - NODE_ID=1
      - NODE_ROLE=learner
    volumes:
      - learner_test_data:/app/data
    ports:
      - "8092:8080"
    networks:
      - paxos_test_network

  store-1-test:
    build:
      context: ../../store
      dockerfile: Dockerfile
    environment:
      - NODE_ID=1
      - NODE_ROLE=store
    volumes:
      - store_1_test_data:/app/data
      - store_1_test_resource:/app/resource
    ports:
      - "8093:8080"
    networks:
      - paxos_test_network

  store-2-test:
    build:
      context: ../../store
      dockerfile: Dockerfile
    environment:
      - NODE_ID=2
      - NODE_ROLE=store
    volumes:
      - store_2_test_data:/app/data
      - store_2_test_resource:/app/resource
    ports:
      - "8094:8080"
    networks:
      - paxos_test_network

  store-3-test:
    build:
      context: ../../store
      dockerfile: Dockerfile
    environment:
      - NODE_ID=3
      - NODE_ROLE=store
    volumes:
      - store_3_test_data:/app/data
      - store_3_test_resource:/app/resource
    ports:
      - "8095:8080"
    networks:
      - paxos_test_network

volumes:
  proposer_test_data:
  acceptor_1_test_data:
  acceptor_2_test_data:
  acceptor_3_test_data:
  learner_test_data:
  store_1_test_data:
  store_2_test_data:
  store_3_test_data:
  store_1_test_resource:
  store_2_test_resource:
  store_3_test_resource:

networks:
  paxos_test_network:
    driver: bridge